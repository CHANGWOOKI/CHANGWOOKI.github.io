---
title: "[JAVA] 실전 정리 - 04(자바 메모리 구조와 static)"
toc: true
toc_sticky: true
toc_label: "Getting Started"
description: null
summary: null
tags: JAVA
published: true
categories:
  - JAVA
---

```java
자바 메모리 구조와 static은 이렇게 자세하게 들었던가
기억이 잘 안난다. 
변수의 생존주기나 static 변수, 메서드를 사용할 때 주의사항을 다시한번 공부한 것 같다.
이겨내자! 창욱
```
### 7) 자바 메모리 구조와 static

#### 자바 메모리 구조 비유
메서드 영역, 스택 영역, 힙 영역 으로 3개로 나눌수 있다.
- 메서드 영역 : 클래스 정보를 보관한다. (ex :  클래스 정보를  붕어빵 틀로 에를 들어보자)
- 스택 영역 : 실제 프로그램이 실행되는 영역이다. 메서드를 실행할 때 마다 하나씩 쌓인다.
- 힙 영역 : 객체의 인스턴스 생성되는 영역이다. new 명령어를 사용하면 이 영역을 사용한다. (ex : 붕어빵 틀로부터 생성된 붕어빵이 존재하는 공간)

#### 자바 메모리 구조 실제

메서드 영역
- 프로그램을 실행하는데 필요한 공통 데이터를 관리한다.
- 프로그램의 모든 영역에서 공유한다.
- 클래스 정보 : 클래스의 실행 코드(바이트 코드), 메서드와 생성자 코드등 모든 실행 코드가 존재한다.
- static 변수들을 보관한다.
- 런타임 상수 풀 : 리터널 문자가 있으면 문자를 공통으로 묶어서 관리한다. (프로그램을 효율적으로 관리하기 위한 상수들은 관리한다)

스택 영역
- 자바 실행 시, 하나의 스택 이 생성된다.
- 각 스택 프레임은 지역 변수, 중간 연산 결과, 메서드 호출 정보 등을 포함한다.
- 스택 프레임 : 스택 영역에 쌓이는 네모 박스가 하나의 스택 프레임이다. 호출할 때 마다 하나씩 쌓이고 종료되면 해당 스택 프레임은 제거된다.
- 쓰레드 수만큼 하나의 실행 스택이 생성된다.

힙 영역
- 인스턴스와 배열이 생성되는 영역이다. 가비지 컬렉션(GC)가 이루어지는 영역이며, 더 이상 참조되지 않는 객체는 GC에 의해 제거된다.

메소드 영역과 힙 영역
- 특정 클래스로 여러개의 인스턴스를 생성하면, 각각의 인스턴스는 내부에 변수와 메서드를 가진다. 변수값은 각각 다르지만 메서드는 공통이므로 변수는 힙 영역에 할당되고 메서드는 메서드 영역에서 공통으로 관리된다.

#### 스택과 자료 구조

##### 스택 구조

후입 선출(LIFO, Last In First Out)
- 1번, 2번 3번 순서대로 스택을 넣었을 때 3번이 가장 먼저 나온다.
- 가장 마지막에 넣은 스택이 제일 먼저 나온다.
- 이런 자료 구조를 `스택`이라고 한다.

선입 선출(FIFO, Fist In First Out)
- 후입 선출과 반대로 가장 먼저 들어간 스택이 제일 먼저 나온다.
- 이런 자료 구조를 `큐(Queue)`라 한다

##### 스택 영역
```java
public class JavaMemoryMain1 {
    public static void main(String[] args) {
        System.out.println("main start");
        method1(10);
        System.out.println("main end");
    }

    static void method1(int m1) {
        System.out.println("method 1 start");
        int cal = m1 * 2;
        method2(cal);
        System.out.println("method 1 end");
    }

    static void method2(int m2) {
        System.out.println("method 2 start");
        System.out.println("method 2 end");
    }
}
// 실행 결과
// main start
// method 1 start
// method 2 start
// method 2 end
// method 1 end
// main end
```

- 자바는 스택 영역을 사용해서 메서드를 호출과 지역 변수(매게변수 포함)를 관리한다.
- 메서드를 계속 호출하면 스택 프레임이 계속 쌓인다.
- 지역 변수(매게변수 포함) 스택 영역에서 관리한다.
- 스택 프레임이 종료되면 지역 변수도 함께 사라진다.
- 스택 프레임이 모두 제거되면 프로그램도 종료된다.

#### 스택 영역과 힙 영역
- 스택 영역에 인스턴스 참조값을 가지고있다.
- 스택이 제거되어 참조값을 가지고 있지 않는 인스턴스는 GC에 의해 제거된다.
- 힙 영역 외부가 아닌, 힙 영역 안에서만 인스턴스끼리 서로 참조하는 경우에도 GC의 대상이 된다.
- 지역 변수는 스택 영역, 인스턴스는 힙 영역에 할당된다.

#### static 변수
- static은 주로 맴버 변수, 메서드에 사용된다.
- 특정 클래스에서 공용으로 함께 사용할 수 있는 변수를 만들 때 사용
- 변수 타입 앞에 static이 붙으면 `static변수, 정적 변수, 클래스 변수` 라고 한다.
- static이 붙은 멤버 변수는 인스턴스가 저장되는 힙 영역이 아니라 메서드 영역의 static 영역에 저장됨

#### 용어 정리
```java
private String name;  // 인스턴스 변수
private static int count; // static 변수
```
인스턴스 변수 : static이 붙지 않은 맴버 변수
- 인스턴스를 생성해야 사용할수 있고 인스턴스에 소속되어있음
- 인스턴스를 생성할 때 마다 새로 만들어진다.

클래스 변수 : static이 붙은 맴버 변수
- static 변수, 정적 변수등으로 불린다.
- static이 붙은 변수는 인스턴스와 무관하게 클래스에 바로 접근해서 사용할 수 있고, 클래스 자체에 소속되어있다.
- 클래스 변수는 자바 프로그램 시작할 때 딱 1개 만들어지며, 인스턴스랑 다르게 공용으로 사용하는 목적으로 만들어진다.

#### 변수와 생명주기
지역변수(매게변수) 
- 스택 영억에 있는 스택 프레임에 보관
- 메서드가 종료되면 스택 프레임도 제거되며 포함된 지역 변수도 삭제된다.(생명주기 짧음)

인스턴스 변수
- 인스턴스에 있는 맴버 변수를 인스턴스 변수라고 한다.
- 힙 영역에 있으며 참조값이 없으면 GC에 의해 제거된다. (GC에 의해 제거 되기 전까지 생존)

클래스 변수
- 변수 타입 앞에 static이 붙으면 클래스 변수, static 변수, 정적 변수라고 한다.
- 메서드 영역에 static 영역에 저장된다.
- 메서드 영역은 프로그램 전체에서 사용하는 공용공간(메모리)이다.
- 해당 클래스가 JVM에 로딩되어 종료될 때 까지 생명주기가 이어진다. (생명 주기가 가장 김)

`static이 정적이라는 이유는 인스턴스 변수는 동적으로 생성되고, 제거된다. 하지만 static인 변수는 프로그램 실행 시점에 만들어지고 종료 시점에 제거된다.`

#### 정적 변수 접근법
```java
public class Data{
  public static int count;
}
public class DataMain{
   public static void main(String[] args) {
    Data data = new Data();

    // 클래스를 통한 접근 (권장)
    System.out.println(Data.count);
    // 인스턴스를 통한 접근 (권장하지 않음)
    System.out.println(data.count);
   }
}
```
- 클래스를 통한 접근을 권장한다.
- 인스턴스로 접근은 가능하지만, 권장하지 않는다.
- 코드를 읽을 때 클래스 변수라고 보기 어렵고, 인스턴스 변수처럼 느껴진다.

#### static 메서드

- 메서드 앞에도 static을 붙일 수 있다.
- 클래스 메서드, 정적 메서드라고 한다.
- 인스턴스 생성없이 클래스에 있는 메서드를 호출한다.
- `ex : Student student = new Student()`라는 인스턴스 생성 없이 사용 가능하다.
- static이 붙지 않은 메서드는 인스턴스 메서드이다.

##### static 메서드 사용법
- `static 메서드는 static만 사용할 수 있다.`
- 클래스 내부 기능을 사용할 때, 정적 메서드나 정적 변수만 사용할 수 있다.
- 인스턴스 변수나, 인스턴스 메서드는 사용할 수 없다.
- `반대로 모든 곳에서 static을 호출할 수 있다.`
- 정적 메서드는 공용 기능이다. 접근 제어자만 허락한다면 클래스를 통해 모든 곳에서 static을 호출할 수 있다.

##### static 메서드 활용
- 인스턴스화 필요 없이 메서드 호출만으로 필요한 기능 수행할 때 사용
- 유틸리티성 메서드, 수학적 계산만 하는 메서드일 때 사용
- 특정 클래스에 static 메서드 하나만 적용하려면 `import static 패키지명.클래스.메서드명`로 해주면된다.
- 특정 클래스에 static 메서드 전부를 적용하려면 `import static 패키지명.클래스.*`로 해주면 된다.

#### main() 메서드 정적 메서드
- 인스턴스 생성 없이 실행하는 가장 대표적인 메서드 main()
- main() 메서드는 프로그램 시작하는 시작점이 되는데, 객체 생성 없이 main() 메서드가 작동했다. static이기 때문이다.
- 따라서 main() 안에서 메서드를 만들 때 static으로 만들어야 한다.


